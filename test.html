<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>People & Fruits</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    section {
      margin-bottom: 30px;
    }
    h2 {
      color: #2c3e50;
    }
  </style>
</head>
<body>

  <h1>People and Fruits App</h1>

  <!-- List All People -->
  <section>
    <h2>All People</h2>
    <button onclick="loadPeople()">Refresh List</button>
    <ul id="peopleList"></ul>
  </section>

  <!-- Create Person -->
  <section>
    <h2>Create New Person</h2>
    <form id="createPersonForm">
      <input type="text" id="firstName" placeholder="First Name" required>
      <input type="text" id="lastName" placeholder="Last Name" required>
      <button type="submit">Create</button>
    </form>
  </section>

  <!-- Add Fruit to Person -->
<section>
  <h2>Add Preferred Fruit to Person</h2>
  <form id="addFruitForm">
    <select id="personSelect" required>
      <option value="">Select Person</option>
    </select>
    <select id="fruitSelect" required>
      <option value="">Select Fruit</option>
    </select>
    <button type="submit">Add Fruit</button>
  </form>
</section>

  <!-- Fruits List -->
  <section>
    <h2>Fruits</h2>
    <button onclick="loadFruits()">Refresh List</button>
    <ul id="fruitList"></ul>
  </section>

  <!-- Create Fruit -->
  <section>
    <h2>Add New Fruit</h2>
    <form id="createFruitForm">
      <input type="text" id="newFruitName" placeholder="Fruit Name" required>
      <button type="submit">Add Fruit</button>
    </form>
  </section>

  <!-- People with Preferred Fruits -->
  <section>
    <h2>People with Preferred Fruits</h2>
    <button onclick="loadPeopleFruits()">Load People-Fruit Table</button>
    <ul id="peopleFruitsList"></ul>
  </section>

  <script>
  const API_URL = 'http://localhost:8080/api';

  function loadPeople() {
    fetch(`${API_URL}/people`)
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById('peopleList');
        list.innerHTML = '';
        const personSelect = document.getElementById('personSelect');
        personSelect.innerHTML = '<option value="">Select Person</option>';

        data.forEach(person => {
          const li = document.createElement('li');
          li.textContent = `#${person.id} - ${person.firstName} ${person.lastName}`;
          list.appendChild(li);

          const option = document.createElement('option');
          option.value = person.id;
          option.textContent = `${person.firstName} ${person.lastName}`;
          personSelect.appendChild(option);
        });
      });
  }
    function loadPeopleFruits() {
    fetch(`${API_URL}/people-fruits`)
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById('peopleFruitsList');
        list.innerHTML = '';

        data.forEach(entry => {
          const li = document.createElement('li');

          const fruits = entry.preferredFruits.map(f => f.name).join(', ') || 'None';
          li.textContent = `${entry.firstName} ${entry.lastName} likes: ${fruits}`;
          list.appendChild(li);
        });
      });
  }

  function loadFruits() {
    fetch(`${API_URL}/fruits`)
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById('fruitList');
        list.innerHTML = '';
        const fruitSelect = document.getElementById('fruitSelect');
        fruitSelect.innerHTML = '<option value="">Select Fruit</option>';

        data.forEach(fruit => {
          const li = document.createElement('li');
          li.textContent = fruit.name;
          list.appendChild(li);

          const option = document.createElement('option');
          option.value = fruit.id;
          option.textContent = fruit.name;
          fruitSelect.appendChild(option);
        });
      });
  }

  document.getElementById('createPersonForm').addEventListener('submit', e => {
    e.preventDefault();
    const firstName = document.getElementById('firstName').value;
    const lastName = document.getElementById('lastName').value;

    fetch(`${API_URL}/people`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ firstName, lastName })
    })
    .then(() => {
      loadPeople();
      e.target.reset();
    });
  });

  document.getElementById('createFruitForm').addEventListener('submit', e => {
    e.preventDefault();
    const name = document.getElementById('newFruitName').value;

    fetch(`${API_URL}/fruits`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name })
    })
    .then(() => {
      loadFruits();
      e.target.reset();
    });
  });

  document.getElementById('addFruitForm').addEventListener('submit', e => {
    e.preventDefault();
    const personId = document.getElementById('personSelect').value;
    const fruitId = document.getElementById('fruitSelect').value;

    fetch(`${API_URL}/people/${personId}/fruit`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ fruit_id: parseInt(fruitId) })
    })
    .then(() => {
      alert("Fruit added!");
      e.target.reset();
      loadPeople(); // Refresh preferred fruits list
    });
  });

  // Initial load
  loadPeople();
  loadFruits();

</script>


</body>
</html>
